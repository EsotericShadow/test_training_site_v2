# Codebase Documentation

This document provides a high-level overview of the Karma Training Website codebase, outlining its structure, key directories, and important architectural patterns.

## 1. Project Structure

The project follows a standard Next.js application structure, with additional directories for documentation, scripts, and shared libraries.

```
karma-training-website/
├── .next/                  # Next.js build output (ignored by Git)
├── docs/                   # Project documentation (this directory)
├── lib/                    # Shared utility functions and modules
├── public/                 # Static assets (images, fonts, etc.)
├── scripts/                # One-off scripts (migrations, seeding, etc.)
├── src/                    # Main application source code
│   ├── app/                # Next.js App Router (pages, API routes, components)
│   │   ├── api/            # API Routes
│   │   ├── components/     # Reusable React components
│   │   ├── hooks/          # Custom React hooks
│   │   └── ...             # Other pages and layouts
│   └── middleware.ts       # Next.js middleware
├── types/                  # TypeScript type definitions
├── .gitignore
├── next.config.ts
├── package.json
├── tsconfig.json
└── ...                     # Other configuration files (ESLint, Jest, PostCSS, Tailwind)
```

## 2. Key Directories and Their Purpose

-   **`.next/`**: This directory is generated by Next.js during the build process. It contains compiled code, build artifacts, and cached data. It should not be manually modified and is typically ignored by version control.

-   **`docs/`**: This directory contains all project documentation, including API specifications, codebase overviews, and security-related documents.

-   **`lib/`**: This directory houses shared utility functions, helper modules, and core business logic that can be reused across different parts of the application. Examples include database operations, security utilities, and session management.

-   **`public/`**: This directory serves static assets directly. Files placed here are accessible from the root of the application (e.g., `public/logo.png` can be accessed at `/logo.png`). It's used for images, fonts, `robots.txt`, and other static files.

-   **`scripts/`**: This directory contains various JavaScript/TypeScript scripts used for development, maintenance, and one-time operations. This includes database migrations, data seeding, and cleanup scripts.

-   **`src/`**: This is the primary source code directory for the Next.js application.
    -   **`src/app/`**: This follows the Next.js App Router convention. It contains: 
        -   **`api/`**: Defines API routes for the backend. Each subdirectory within `api` typically represents a distinct API endpoint or a group of related endpoints. Dynamic routes are indicated by `[param]` syntax.
        -   **`components/`**: Contains reusable React components organized by feature or domain (e.g., `admin`, `forms`, `home`, `layout`, `theme`, `ui`).
        -   **`hooks/`**: Custom React hooks for encapsulating reusable stateful logic.
        -   Other top-level directories within `app` (e.g., `about`, `contact`, `courses`, `privacy`, `terms`) represent different pages or sections of the website.
    -   **`src/middleware.ts`**: Next.js middleware for intercepting requests and performing logic before they are handled by routes (e.g., authentication, redirection).

-   **`types/`**: This directory contains TypeScript type definitions (`.ts` files) that define the data structures used throughout the application, ensuring type safety and improving code readability.

## 3. Architectural Patterns

### 3.1. Next.js App Router

The application leverages the Next.js App Router for routing, data fetching, and rendering. This includes:
-   **Server Components**: Used for rendering UI on the server, improving initial page load performance and SEO.
-   **Client Components**: Used for interactive UI elements that require client-side JavaScript.
-   **API Routes**: Defined within `src/app/api/` for building backend API endpoints.

### 3.2. Database Interaction

Database operations are primarily handled through the `lib/database.ts` module, which encapsulates interactions with the PostgreSQL database (likely via Vercel Postgres). This promotes a separation of concerns, making database logic reusable and testable.

### 3.3. Authentication and Authorization

Authentication for admin users is managed through secure JWTs and sessions. Key components involved include:
-   **`lib/secure-jwt.ts`**: Handles the generation and validation of secure JSON Web Tokens.
-   **`lib/session-manager.ts`**: Manages admin user sessions, including creation, validation, and termination.
-   **`lib/account-security.ts`**: Implements security features like account lockout and failed login attempt tracking.
-   **`src/middleware.ts`**: Used for protecting routes that require authentication.

### 3.4. Security Utilities

The `lib/security-utils.ts` module provides functions for input sanitization, validation, and rate limiting, ensuring that data processed by the application is clean and that the application is protected against common vulnerabilities.

### 3.5. File Uploads

File uploads are handled via Vercel Blob storage, with metadata stored in the application's database. The `/api/adm_f7f8556683f1cdc65391d8d2_8e91/upload` API route manages the upload process, including file validation and database record creation.

## 4. Development Practices

-   **TypeScript**: The project is written in TypeScript, providing static type checking for improved code quality and maintainability.
-   **ESLint**: Used for code linting to enforce consistent coding styles and identify potential issues.
-   **Jest**: Used for unit and integration testing.
-   **Environment Variables**: Sensitive information and configuration settings are managed using environment variables (e.g., via `.env.local` and `dotenv`).

This documentation provides a foundational understanding of the codebase. For detailed API specifications, refer to `docs/API_ROUTES.md`.